[source](https://www.html5rocks.com/ja/tutorials/internals/howbrowserswork/)

Source Code (HTML, DTD(Document Type Definition))
↓
Lexar&Parser
[Flex (lexical analyser generator)](https://en.wikipedia.org/wiki/Flex_(lexical_analyser_generator))
[GNU Bison](http://www.gnu.org/software/bison/)
↓ 
Parse Tree
(Document Object Model)
> HTML ドキュメントや、HTML 要素と JavaScript などの外部世界とのインターフェースをオブジェクトで表現したもの

* javascriptは、読み込まれた時点でHTMLのParseを中断。
  * Deferで非同期にできる。
* CSSは、HTMLの構造を変化させないので、基本的にはHTMLのParseを中断しない。

> ドキュメントの解析段階でスクリプトがスタイル情報を要求するという問題があります。スタイルの読み込みと解析がまだ済んでいない場合、スクリプトは誤った回答を受け取ることになり、さまざまな問題を引き起こす可能性があります。これは特殊なケースのように見えますが、実際にはよく起きています。Firefox では、読み込みや解析が途中のスタイル シートがある場合、すべてのスクリプトをブロックしています。Webkit では、まだ読み込まれていないスタイル シートの影響を受けそうな特定のスタイル プロパティにスクリプトがアクセスしようとした場合にのみ、スクリプトをブロックします。

↓ 
Parse Tree + Style (Attachment)

> レンダラーは DOM 要素に対応していますが、その関係は 1 対 1 ではありません。視覚的でない DOM 要素はレンダー ツリーに挿入されません。

> DOM 要素が複数の視覚的オブジェクト(レンダーオブジェクト)に対応している場合があります。

> レンダラー オブジェクトによっては、1 つの DOM ノードに対応していても、ツリー内の同じ場所にないものもあります。フロートや絶対的に配置された要素は、フローから外れてツリー内の別の場所に置かれてから、実際のフレームにマッピングされます。それらに対応する場所にはプレースホルダ フレームが配置されます。

> DOM ツリーにノードが挿入されると、新しいノードの「attach」メソッドが呼び出されます。

> html タグと body タグを処理すると、レンダー ツリーのルートが構築されます。ルートのレンダー オブジェクトは CSS 仕様で「包含ブロック」と呼ばれるものに相当します（他のすべてのブロックを含む最上位のブロックです）
このルートのオブジェクトは、Firefox では「ViewPortFrame」、Webkit では「RenderView」と呼ばれており、ドキュメントが指しているレンダー オブジェクトです。

↓
Render Tree

> スタイルの計算
レンダー ツリーを構築するには、各レンダー オブジェクトの視覚的プロパティを計算する必要があります。この処理は各要素のスタイル プロパティを計算することで行います。
スタイルには、さまざまなソースのスタイル シート、インラインのスタイル要素、HTML 内の視覚的なプロパティ（「bgcolor」プロパティなど）があります。後者は一致する CSS スタイル プロパティに変換されます。

> ブラウザのデフォルトのスタイル シート、ページ作成者が提供するスタイル シート、ユーザーのスタイル シートがあります。ユーザーのスタイル シートとは、ブラウザのユーザーが用意したスタイル シートのことです（ブラウザでお気に入りのスタイルを定義できます。たとえば、Firefox では、「Firefox プロファイル」フォルダにスタイル シートを配置します）。

> スタイルの計算にはいくつかの問題点があります。
1.スタイル データは多数のスタイル プロパティを含む非常に大きな構造体なので、メモリの問題が起きる可能性があります。
2.最適化されていない場合、要素ごとにマッチング ルールを探索すると、パフォーマンスの問題が起きる可能性があります。
3.適用するルールには、ルールの階層を定義した非常に複雑なカスケード ルールもあります。

> スタイル データの共有
Webkit のノードはスタイル オブジェクト（RenderStyle）を参照しています。条件によっては、複数のノードでこのオブジェクトを共有することができます。ノードが「兄弟」か「いとこ」の関係にあり、要素が次の条件に該当する場合です。

> table div {margin:5px}
キーは右側のセレクタ（div）なので、タグ マップから抽出されますが、マップに含まれる div 要素には table という先祖がないため、一致しないことになります。

> カスケード順序は次のとおりです（低から高の順）。
ブラウザの宣言
ユーザーの通常の宣言
制作者の通常の宣言
制作者の重要な宣言
ユーザーの重要な宣言

> レイアウト
通常、フロー内で後の方の要素が最初の方の要素の配置に影響を与えることはないため、ドキュメントの左から右へ、上から下へとレイアウトを進めることができます。
レイアウトは再帰的な処理です。HTML ドキュメントの <html> 要素に対応するルートのレンダラーから始まります。

> ダーティ ビット システム
小さな変更があるたびに完全なレイアウト処理を行わなくても済むように、ブラウザでは「ダーティ ビット」システムを使用しています。変更または追加されたレンダラーは自身とその子を「ダーティ」としてマークし、レイアウトが必要なことを表します。
「ダーティ（dirty）」と「子がダーティ（children are dirty）」の 2 つのフラグがあります。「子がダーティ」とは、レンダラー自体はそのままでよいが、レイアウトが必要な子が少なくとも 1 つあるという意味です。


> レンダリング エンジンはシングル スレッドです。
> ブラウザのメイン スレッドはイベント ループです。
